{"ast":null,"code":"/**\n * this contains a mapping to basic dependencies\n * which should be easy to change\n */\nimport randomToken from 'random-token';\nimport RxError from './rx-error';\nimport { default as deepClone } from 'clone';\n/**\n * check if the given module is a leveldown-adapter\n * throws if not\n */\n\nexport function isLevelDown(adapter) {\n  if (!adapter || typeof adapter.super_ !== 'function') {\n    throw RxError.newRxError('UT4', {\n      adapter: adapter\n    });\n  }\n}\n/**\n * this is a very fast hashing but its unsecure\n * @link http://stackoverflow.com/questions/7616461/generate-a-hash-from-string-in-javascript-jquery\n * @param  {object} obj\n * @return {number} a number as hash-result\n */\n\nexport function fastUnsecureHash(obj) {\n  if (typeof obj !== 'string') obj = JSON.stringify(obj);\n  var hash = 0,\n      i,\n      chr,\n      len;\n  if (obj.length === 0) return hash;\n\n  for (i = 0, len = obj.length; i < len; i++) {\n    chr = obj.charCodeAt(i);\n    hash = (hash << 5) - hash + chr;\n    hash |= 0; // Convert to 32bit integer\n  }\n\n  if (hash < 0) hash = hash * -1;\n  return hash;\n}\n/**\n *  spark-md5 is used here\n *  because pouchdb uses the same\n *  and build-size could be reduced by 9kb\n */\n\nimport Md5 from 'spark-md5';\nexport function hash(obj) {\n  var msg = obj;\n  if (typeof obj !== 'string') msg = JSON.stringify(obj);\n  return Md5.hash(msg);\n}\n/**\n * generate a new _id as db-primary-key\n * @return {string}\n */\n\nexport function generateId() {\n  return randomToken(10) + ':' + new Date().getTime();\n}\n/**\n * returns a promise that resolves on the next tick\n * @return {Promise}\n */\n\nexport function nextTick() {\n  return new Promise(function (res) {\n    return setTimeout(res, 0);\n  });\n}\n/**\n * [promiseWait description]\n * @param  {Number}  [ms=0]\n * @return {Promise}\n */\n\nexport function promiseWait() {\n  var ms = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n  return new Promise(function (res) {\n    return setTimeout(res, ms);\n  });\n}\nexport function requestIdlePromise() {\n  var timeout = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n\n  if (typeof window === 'object' && window.requestIdleCallback) {\n    return new Promise(function (res) {\n      return window.requestIdleCallback(res, {\n        timeout: timeout\n      });\n    });\n  } else return Promise.resolve();\n}\n/**\n * like Promise.all() but runs in series instead of parallel\n * @link https://github.com/egoist/promise.series/blob/master/index.js\n * @param {Function[]} tasks array with functions that return a promise\n * @return {Promise<Array>}\n */\n\nexport function promiseSeries(tasks, initial) {\n  return tasks.reduce(function (current, next) {\n    return current.then(next);\n  }, Promise.resolve(initial));\n}\n/**\n * run the callback if requestIdleCallback available\n * do nothing if not\n * @link https://developer.mozilla.org/de/docs/Web/API/Window/requestIdleCallback\n * @param  {function} fun\n * @return {void}\n */\n\nexport function requestIdleCallbackIfAvailable(fun) {\n  if (typeof window === 'object' && window.requestIdleCallback) window.requestIdleCallback(fun);\n}\n/**\n * uppercase first char\n * @param  {string} str\n * @return {string} Str\n */\n\nexport function ucfirst(str) {\n  str += '';\n  var f = str.charAt(0).toUpperCase();\n  return f + str.substr(1);\n}\n/**\n * @link https://de.wikipedia.org/wiki/Base58\n * this does not start with the numbers to generate valid variable-names\n */\n\nvar base58Chars = 'abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ123456789';\nvar base58Length = base58Chars.length;\n/**\n * transform a number to a string by using only base58 chars\n * @link https://github.com/matthewmueller/number-to-letter/blob/master/index.js\n * @param {number} nr                                       | 10000000\n * @return {string} the string-representation of the number | '2oMX'\n */\n\nexport function numberToLetter(nr) {\n  var digits = [];\n\n  do {\n    var v = nr % base58Length;\n    digits.push(v);\n    nr = Math.floor(nr / base58Length);\n  } while (nr-- > 0);\n\n  return digits.reverse().map(function (d) {\n    return base58Chars[d];\n  }).join('');\n}\n/**\n * removes trailing and ending dots from the string\n * @param  {string} str\n * @return {string} str without wrapping dots\n */\n\nexport function trimDots(str) {\n  // start\n  while (str.charAt(0) === '.') {\n    str = str.substr(1);\n  } // end\n\n\n  while (str.slice(-1) === '.') {\n    str = str.slice(0, -1);\n  }\n\n  return str;\n}\n/**\n * validates that a given string is ok to be used with couchdb-collection-names\n * @link https://wiki.apache.org/couchdb/HTTP_database_API\n * @param  {string} name\n * @throws  {Error}\n * @return {boolean} true\n */\n\nexport function validateCouchDBString(name) {\n  if (typeof name !== 'string' || name.length === 0) {\n    throw RxError.newRxTypeError('UT1', {\n      name: name\n    });\n  } // do not check, if foldername is given\n\n\n  if (name.includes('/') || // unix\n  name.includes('\\\\') // windows\n  ) return true;\n  var regStr = '^[a-z][_$a-z0-9]*$';\n  var reg = new RegExp(regStr);\n\n  if (!name.match(reg)) {\n    throw RxError.newRxError('UT2', {\n      regex: regStr,\n      givenName: name\n    });\n  }\n\n  return true;\n}\n/**\n * deep-sort an object so its attributes are in lexical order.\n * Also sorts the arrays inside of the object if no-array-sort not set\n * @param  {Object} obj unsorted\n * @param  {?boolean} noArraysort\n * @return {Object} sorted\n */\n\nexport function sortObject(obj) {\n  var noArraySort = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n  if (!obj) return obj; // do not sort null, false or undefined\n  // array\n\n  if (!noArraySort && Array.isArray(obj)) {\n    return obj.sort(function (a, b) {\n      if (typeof a === 'string' && typeof b === 'string') return a.localeCompare(b);\n      if (typeof a === 'object') return 1;else return -1;\n    }).map(function (i) {\n      return sortObject(i);\n    });\n  } // object\n\n\n  if (typeof obj === 'object') {\n    if (obj instanceof RegExp) return obj;\n    var out = {};\n    Object.keys(obj).sort(function (a, b) {\n      return a.localeCompare(b);\n    }).forEach(function (key) {\n      out[key] = sortObject(obj[key]);\n    });\n    return out;\n  } // everything else\n\n\n  return obj;\n}\n/**\n * used to JSON.stringify() objects that contain a regex\n * @link https://stackoverflow.com/a/33416684 thank you Fabian Jakobs!\n */\n\nexport function stringifyFilter(key, value) {\n  if (value instanceof RegExp) return value.toString();\n  return value;\n}\n/**\n * get the correct function-name for pouchdb-replication\n * @param {object} pouch - instance of pouchdb\n * @return {function}\n */\n\nexport function pouchReplicationFunction(pouch, _ref) {\n  var _ref$pull = _ref.pull,\n      pull = _ref$pull === void 0 ? true : _ref$pull,\n      _ref$push = _ref.push,\n      push = _ref$push === void 0 ? true : _ref$push;\n  if (pull && push) return pouch.sync.bind(pouch);\n  if (!pull && push) return pouch.replicate.to.bind(pouch);\n  if (pull && !push) return pouch.replicate.from.bind(pouch);\n\n  if (!pull && !push) {\n    throw RxError.newRxError('UT3', {\n      pull: pull,\n      push: push\n    });\n  }\n}\n/**\n * get a random string which can be used with couchdb\n * @link http://stackoverflow.com/a/1349426/3443137\n * @param {number} [length=10] length\n * @return {string}\n */\n\nexport function randomCouchString() {\n  var length = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 10;\n  var text = '';\n  var possible = 'abcdefghijklmnopqrstuvwxyz';\n\n  for (var i = 0; i < length; i++) {\n    text += possible.charAt(Math.floor(Math.random() * possible.length));\n  }\n\n  return text;\n}\n/**\n * shuffle the given array\n * @param  {Array<any>} arr\n * @return {Array<any>}\n */\n\nexport function shuffleArray(arr) {\n  return arr.sort(function () {\n    return Math.random() - 0.5;\n  });\n}\n/**\n * transforms the given adapter into a pouch-compatible object\n * @return {Object} adapterObject\n */\n\nexport function adapterObject(adapter) {\n  var adapterObj = {\n    db: adapter\n  };\n\n  if (typeof adapter === 'string') {\n    adapterObj = {\n      adapter: adapter\n    };\n  }\n\n  return adapterObj;\n}\n\nfunction recursiveDeepCopy(o) {\n  if (!o) return o;\n  return deepClone(o, false);\n}\n\nexport var clone = recursiveDeepCopy;\nimport isElectron from 'is-electron';\nexport var isElectronRenderer = isElectron();\n/**\n * returns a flattened object\n * @link https://gist.github.com/penguinboy/762197\n */\n\nexport function flattenObject(ob) {\n  var toReturn = {};\n\n  for (var i in ob) {\n    if (!ob.hasOwnProperty(i)) continue;\n\n    if (typeof ob[i] == 'object') {\n      var flatObject = flattenObject(ob[i]);\n\n      for (var x in flatObject) {\n        if (!flatObject.hasOwnProperty(x)) continue;\n        toReturn[i + '.' + x] = flatObject[x];\n      }\n    } else {\n      toReturn[i] = ob[i];\n    }\n  }\n\n  return toReturn;\n}\n/**\n *\n * @param {string} revString\n * @return {number}\n */\n\nexport function getHeightOfRevision(revString) {\n  var first = revString.split('-')[0];\n  return parseInt(first);\n}","map":null,"metadata":{},"sourceType":"module"}