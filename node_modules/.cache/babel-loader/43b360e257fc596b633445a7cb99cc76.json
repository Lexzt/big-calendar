{"ast":null,"code":"import { map, mergeMap, catchError } from 'rxjs/operators';\nimport { ofType } from 'redux-observable';\nimport { from } from 'rxjs';\nimport { API_KEY, GOOGLE_CLIENT_ID, GOOGLE_SCOPE } from '../utils/google';\nimport { BEGIN_GOOGLE_AUTH, successGoogleAuth, failGoogleAuth } from '../actions/auth';\nvar GoogleAuth = '';\n\nvar handleAuthClick = function handleAuthClick(auth) {\n  if (auth.isSignedIn.get()) {\n    console.log(\"Signed In to Google!\");\n  } else {\n    auth.signIn();\n  }\n};\n\nvar loginGoogle = function loginGoogle() {\n  /*window.gapi.load('client:auth2', {\n    callback: () => {\n      window.gapi.client.init({\n          'apiKey': API_KEY,\n          'clientId': GOOGLE_CLIENT_ID,\n          'scope': GOOGLE_SCOPE,\n          'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\n      }).then(() => {\n          GoogleAuth = window.gapi.auth2.getAuthInstance();\n          //GoogleAuth.signIn();\n          handleAuthClick(GoogleAuth);\n          const user = GoogleAuth.currentUser.get();\n          const isAuthorized = user.hasGrantedScopes(GOOGLE_SCOPE);\n          debugger\n          return isAuthorized;\n      })\n    }\n  });*/\n  return window.gapi.load('client:auth2', initClient);\n};\n\nvar initClient = function initClient() {\n  window.gapi.client.init({\n    'apiKey': API_KEY,\n    'clientId': GOOGLE_CLIENT_ID,\n    'scope': GOOGLE_SCOPE,\n    'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest']\n  }).then(function () {\n    GoogleAuth = window.gapi.auth2.getAuthInstance(); //GoogleAuth.signIn();\n\n    handleAuthClick(GoogleAuth);\n    var user = GoogleAuth.currentUser.get();\n    var isAuthorized = user.hasGrantedScopes(GOOGLE_SCOPE);\n    debugger;\n    return isAuthorized;\n  });\n};\n\nexport var beginGoogleAuthEpic = function beginGoogleAuthEpic(action$) {\n  return action$.pipe(ofType(BEGIN_GOOGLE_AUTH), mergeMap(function () {\n    return from(loginGoogle()).pipe(map(function () {\n      var isAuthorized = GoogleAuth.currentUser.get().hasGrantedScopes(GOOGLE_SCOPE);\n\n      if (isAuthorized) {\n        return successGoogleAuth();\n      } else {\n        return failGoogleAuth();\n      }\n    }));\n  }));\n};","map":{"version":3,"sources":["/Users/sham/big-calendar/src/epics/auth.js"],"names":["map","mergeMap","catchError","ofType","from","API_KEY","GOOGLE_CLIENT_ID","GOOGLE_SCOPE","BEGIN_GOOGLE_AUTH","successGoogleAuth","failGoogleAuth","GoogleAuth","handleAuthClick","auth","isSignedIn","get","console","log","signIn","loginGoogle","window","gapi","load","initClient","client","init","then","auth2","getAuthInstance","user","currentUser","isAuthorized","hasGrantedScopes","beginGoogleAuthEpic","action$","pipe"],"mappings":"AAAA,SAASA,GAAT,EAAcC,QAAd,EAAwBC,UAAxB,QAA0C,gBAA1C;AACA,SAASC,MAAT,QAAuB,kBAAvB;AACA,SAASC,IAAT,QAAqB,MAArB;AACA,SAASC,OAAT,EAAkBC,gBAAlB,EAAoCC,YAApC,QAAwD,iBAAxD;AACA,SACEC,iBADF,EAEEC,iBAFF,EAGEC,cAHF,QAIO,iBAJP;AAMA,IAAIC,UAAU,GAAG,EAAjB;;AAEA,IAAMC,eAAe,GAAG,SAAlBA,eAAkB,CAACC,IAAD,EAAU;AAChC,MAAGA,IAAI,CAACC,UAAL,CAAgBC,GAAhB,EAAH,EAA0B;AACxBC,IAAAA,OAAO,CAACC,GAAR,CAAY,sBAAZ;AACD,GAFD,MAGK;AACHJ,IAAAA,IAAI,CAACK,MAAL;AACD;AACF,CAPD;;AASA,IAAMC,WAAW,GAAG,SAAdA,WAAc,GAAM;AACxB;;;;;;;;;;;;;;;;;;AAmBA,SAAOC,MAAM,CAACC,IAAP,CAAYC,IAAZ,CAAiB,cAAjB,EAAiCC,UAAjC,CAAP;AACD,CArBD;;AAuBA,IAAMA,UAAU,GAAG,SAAbA,UAAa,GAAM;AACvBH,EAAAA,MAAM,CAACC,IAAP,CAAYG,MAAZ,CAAmBC,IAAnB,CAAwB;AACpB,cAAUpB,OADU;AAEpB,gBAAYC,gBAFQ;AAGpB,aAASC,YAHW;AAIpB,qBAAiB,CAAC,4DAAD;AAJG,GAAxB,EAKGmB,IALH,CAKQ,YAAM;AACVf,IAAAA,UAAU,GAAGS,MAAM,CAACC,IAAP,CAAYM,KAAZ,CAAkBC,eAAlB,EAAb,CADU,CAEV;;AACAhB,IAAAA,eAAe,CAACD,UAAD,CAAf;AACA,QAAMkB,IAAI,GAAGlB,UAAU,CAACmB,WAAX,CAAuBf,GAAvB,EAAb;AACA,QAAMgB,YAAY,GAAGF,IAAI,CAACG,gBAAL,CAAsBzB,YAAtB,CAArB;AACA;AACA,WAAOwB,YAAP;AACH,GAbD;AAcD,CAfD;;AAiBA,OAAO,IAAME,mBAAmB,GAAG,SAAtBA,mBAAsB,CAAAC,OAAO;AAAA,SAAIA,OAAO,CAACC,IAAR,CAC5ChC,MAAM,CAACK,iBAAD,CADsC,EAE5CP,QAAQ,CAAC;AAAA,WAAMG,IAAI,CAACe,WAAW,EAAZ,CAAJ,CAAoBgB,IAApB,CACbnC,GAAG,CAAC,YAAM;AACR,UAAM+B,YAAY,GAAGpB,UAAU,CACdmB,WADI,CAEJf,GAFI,GAGJiB,gBAHI,CAGazB,YAHb,CAArB;;AAIA,UAAGwB,YAAH,EAAiB;AACf,eAAOtB,iBAAiB,EAAxB;AACD,OAFD,MAGK;AACH,eAAOC,cAAc,EAArB;AACD;AACF,KAXE,CADU,CAAN;AAAA,GAAD,CAFoC,CAAJ;AAAA,CAAnC","sourcesContent":["import { map, mergeMap, catchError } from 'rxjs/operators';\nimport { ofType } from 'redux-observable';\nimport { from } from 'rxjs';\nimport { API_KEY, GOOGLE_CLIENT_ID, GOOGLE_SCOPE } from '../utils/google';\nimport {\n  BEGIN_GOOGLE_AUTH,\n  successGoogleAuth,\n  failGoogleAuth\n} from '../actions/auth';\n\nlet GoogleAuth = '';\n\nconst handleAuthClick = (auth) => {\n  if(auth.isSignedIn.get()) {\n    console.log(\"Signed In to Google!\");\n  }\n  else {\n    auth.signIn();\n  }\n}\n\nconst loginGoogle = () => {\n  /*window.gapi.load('client:auth2', {\n    callback: () => {\n      window.gapi.client.init({\n          'apiKey': API_KEY,\n          'clientId': GOOGLE_CLIENT_ID,\n          'scope': GOOGLE_SCOPE,\n          'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\n      }).then(() => {\n          GoogleAuth = window.gapi.auth2.getAuthInstance();\n          //GoogleAuth.signIn();\n          handleAuthClick(GoogleAuth);\n          const user = GoogleAuth.currentUser.get();\n          const isAuthorized = user.hasGrantedScopes(GOOGLE_SCOPE);\n          debugger\n          return isAuthorized;\n      })\n    }\n  });*/\n\n  return window.gapi.load('client:auth2', initClient);\n}\n\nconst initClient = () => {\n  window.gapi.client.init({\n      'apiKey': API_KEY,\n      'clientId': GOOGLE_CLIENT_ID,\n      'scope': GOOGLE_SCOPE,\n      'discoveryDocs': ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],\n  }).then(() => {\n      GoogleAuth = window.gapi.auth2.getAuthInstance();\n      //GoogleAuth.signIn();\n      handleAuthClick(GoogleAuth);\n      const user = GoogleAuth.currentUser.get();\n      const isAuthorized = user.hasGrantedScopes(GOOGLE_SCOPE);\n      debugger\n      return isAuthorized;\n  })\n}\n\nexport const beginGoogleAuthEpic = action$ => action$.pipe(\n  ofType(BEGIN_GOOGLE_AUTH),\n  mergeMap(() => from(loginGoogle()).pipe(\n    map(() => {\n      const isAuthorized = GoogleAuth\n                      .currentUser\n                      .get()\n                      .hasGrantedScopes(GOOGLE_SCOPE);\n      if(isAuthorized) {\n        return successGoogleAuth()\n      }\n      else {\n        return failGoogleAuth();\n      }\n    })\n  ))\n)\n"]},"metadata":{},"sourceType":"module"}